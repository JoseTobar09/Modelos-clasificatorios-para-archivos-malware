import os
import pefile
import glob
import csv

# Abrir el archivo CSV para escritura
with open('datosdearchivosPE.csv', 'w', newline='') as csvfile:
    # Crear un escritor CSV
    csvwriter = csv.writer(csvfile)
    
    # Escribir la fila de encabezado
    csvwriter.writerow([
        "AddressOfEntryPoint",
        "MajorLinkerVersion",
        "MajorImageVersion",
        "MajorOperatingSystemVersion",
        "DllCharacteristics",
        "SizeOfStackReserve",
        "NumberOfSections",
        "ResourceSize"
    ])

    # Encontrar archivos .exe
    files = glob.glob(r'C:\Users\JOSE TOBAR\Documents\Mestria en analitica de datos\#5 Modelos predictivos\proyecto\ejemplos_archivos\*.exe')
    
    for file in files:
        try:
            suspect_pe = pefile.PE(file)

            # Escribir los datos de cada archivo PE
            csvwriter.writerow([
                suspect_pe.OPTIONAL_HEADER.AddressOfEntryPoint,
                suspect_pe.OPTIONAL_HEADER.MajorLinkerVersion,
                suspect_pe.OPTIONAL_HEADER.MajorImageVersion,
                suspect_pe.OPTIONAL_HEADER.MajorOperatingSystemVersion,
                suspect_pe.OPTIONAL_HEADER.DllCharacteristics,
                suspect_pe.OPTIONAL_HEADER.SizeOfStackReserve,
                suspect_pe.FILE_HEADER.NumberOfSections,
                suspect_pe.OPTIONAL_HEADER.DATA_DIRECTORY[2].Size
            ])
        except Exception as e:
            print(f"Error procesando el archivo {file}: {e}")

print("listo")
